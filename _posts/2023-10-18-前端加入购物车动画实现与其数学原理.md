---
title: 前端加入购物车动画实现与其数学原理
tags:
  - JavaScript
  - CSS
  - 动画
  - 数学
key: blog-comments
---
本文讲解前端如何实现加入购物车动画,以及实现过程中的数学原理。

<!--more-->
## 前言
在最近的一次前端项目中,需要实现加入购物车的抛物线动画,然后实现抛物线动画的过程中,有部分原来当初学习的数学知识是有实践作用的,因此记录下来此次的心得与体会,望与大家共勉,感谢。

## 前端加入购物车动画的实现
我们的目标是实现加入购物车动画,那么可以简单地画一个效果示意图

在前端实现这个效果主要有以下两种实现方式。

### 利用嵌套元素线性叠加平移动画实现
一开始从互联网搜索加入购物车动画实现,便会看到绝大部分的实现方式都是这种方式。

```html
<div class="box">
  <div class="content">
    <div class="inner"></div>
  </div>
</div>
```
```css
.box {
  width: 400px;
  height: 400px;
  background-color: #eee;
  margin: 0 auto;
  display: flex;
  justify-content: flex-end;
}

.content {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: #fff;
}

.inner {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: #f0f;
}
```

现在有一个嵌套的场景, `.content` 元素包裹着 `.inner` 元素,如果我们在鼠标悬停时候给 `.content` 元素增加沿X轴平移-300px的动画,并且给 `.inner` 元素增加沿Y轴平移300px的动画,那么这时候 `.content` 元素和 `.inner` 元素分别的运动轨迹是怎样的呢?

```css
/* 增加平移动画 */
.content {
  margin:30px;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: #fff;
  transition: all 1s linear;
}

.inner {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: #f0f;
  transition: all 1s linear;
}

/* 鼠标悬停效果 */
.content:hover {
  transform: translateX(-300px);
}

.content:hover .inner {
  transform: translateY(300px);
}
```

我们会发现 `.content` 元素会向左平移,符合预期,但 `.inner` 元素往左下斜线运动了,为什么会产生这种视觉效果呢?

- 嵌套的元素位移: `.inner` 是 `.content` 的子元素，他的位置是相对于 `.content` 的 。且 `.content` 在向左移动的同时，`.inner` 也会随之向右移动。

- 位移的线性叠加: `.inner` 本身还有一个单独的 `translateY` 操作，它会在 `.content` 向左平移的过程中相对向下平移。因此，`.inner` 的运动路径形成一个组合运动——既向左又向下，看起来像是在做“斜向的运动”。


但是现在的实现效果与我们的预期存在差别,现在 `.inner` 元素是斜线向下的,不真实自然,因为现在存在惯性与引力,所以运动轨迹应该是曲线的,也就是曲率不能为0.

那么这种情况下如何将线性叠加的斜线运动变为曲线呢,这时候我们就会使用到 [transition-timing-function](https://developer.mozilla.org/zh-CN/docs/Web/CSS/transition-timing-function) , `transition-timing-function` 可以设置元素过渡动画的变化“速率”,我们把 `.inner` 的 `transition-timing-function` 设置为相对于线性先慢后快,就会形成看起来像是在做“斜向的抛物线运动”的线性叠加效果。

```css
...
.inner {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background-color: #f0f;
  transition: all 1s cubic-bezier(.51, .1, .78, .4);
}
...
```

`cubic-bezier(.51, .1, .78, .4)` 是表示一个先快后慢的缓动曲线。
· 初始阶段：曲线的斜率较大，表示运动开始较快。
· 后半部分：曲线逐渐趋平，斜率减小，表示运动逐渐减速。

在这种贝塞尔曲线中，控制点 (0.51, 0.1) 接近起点且偏向下方，表示一开始速度较快；而 (0.78, 0.4) 位于靠近中间位置，这样的布局使曲线在尾部逐渐减速并平滑结束。因此，这种曲线适合用来实现先快后慢的过渡效果。

但如果你使用的是 [cubic-bezier动画配置网站](https://cubic-bezier.com/#.51,.1,.78,.4) 演示,你会发现相对于 `linear` 会显得速度是先慢后快,其实是对的,因为你查看加速度的曲线，就能看出 `cubic-bezier(.51, .1, .78, .4)`曲线的斜率不均匀,初始部分斜率小，意味着起始速度较慢；中间部分斜率较大，速度增加；到最后部分斜率再次减小，速度逐渐减缓。而线性曲线,斜率恒定为1.

### 利用抛物线方程实现

上面的线性叠加实现,还是存在缺点的,例如现在需要运动先往上抛,然后再往下,上面的线性叠加方案就比较难实现了,这时候我们可以使用前端的 [requestAnimationFrame](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame) 来根据用户屏幕的频率不断地回调动画,移动小圆球元素来实现抛物线动画效果,那么如果计算任意时刻下小圆球元素的坐标点,那么我们需要运用初中数学学到的抛物线方程。


